# requirements.md（ReAct型データ分析AIエージェント）

## 背景・目的

ユーザーがアップロードしたCSVに対して、対話しながら分析を進め、最終的に**Markdownレポート形式**で結果をUI表示できるReAct型データ分析エージェントを提供する。このプロジェクトは、LangGraphの調査の一環として作成するものであり本番環境でのデプロイは行わない。

## スコープ

### IN（対象）

- Streamlit UIでの対話
- CSVアップロード（UI経由）
- ReActによる「分析を実行するべきか / 追加質問するべきか」の自律判断
- 対応分析（MVP）:
  - 欠損値処理（補完・削除等のデータ加工）
  - EDA（データ概要、基本統計、列要約、重複チェック）
  - groupby集計（フィルタ・並べ替え・top-k・構成比/パレート含む）
  - 基本的なグラフ描画（例: hist / scatter / line / bar / box）
  - 必要に応じた相関分析（例: 相関係数、相関行列）
- グラフ表示（UI上）
- 最終レポート表示（Markdown、最低限: 結論・根拠）

### OUT（対象外）

- Web検索・外部API呼び出し等（**OpenAI以外の外部通信**）
- モデリング（予測/分類）などMVP範囲外の高度分析（将来拡張）
- データの永続化

## 機能要件（EARS）

### 対話

- REQ-CHAT-001: ユーザーがメッセージを送信した**とき**、エージェントは対話を継続できる形で応答**しなければならない**。
- REQ-CTX-001: エージェントは**同一セッション内**の会話履歴を保持し、過去の分析結果を参照できる形で対話を継続**しなければならない**。

### データ取り込み（UI経由）

- REQ-DATA-001: ユーザーがCSVをアップロードした**とき**、エージェントはデータ概要（行数/列数）を提示**しなければならない**。

### ReAct（判断・質問・仮定）

- REQ-REACT-001: ユーザーが分析要求を行った**とき**、エージェントは要求の明確性を評価し、十分明確なら分析を実行し、不明確なら追加質問を行う、を選択**しなければならない**。
- REQ-REACT-002: エージェントが追加質問を行う**とき**、分析に必要な不足情報を埋める**最小限の質問**を提示**しなければならない**。質問の中に仮説を提示する必要がある。
- REQ-REACT-003: 追加質問を行った**場合**、エージェントはユーザーからの返答が得られるまで待機**しなければならない**。

### 分析実行（MVP）

- REQ-ACT-001: エージェントが分析を実行すると判断した**とき**、**ユーザー要求（および合意した追加提案）に必要な範囲で**、EDA/集計/可視化/相関のうち適切なものを実行**しなければならない**。
- REQ-PLOT-001: ユーザーの分析依頼を達成するためにグラフが必要だと判断した**とき**、エージェントは要求に適した最小限の図表を生成し、UIに表示**しなければならない**。

### レポート

- REQ-REPORT-001: エージェントが最終結果を提示する**とき**、結果をMarkdownレポートとして（少なくとも**結論・根拠**を含めて）UIに表示**しなければならない**。
- REQ-REPORT-002: 仮定に基づいて分析を進めた**とき**、その仮定を最終レポートに明記**しなければならない**。

### 完了条件

- REQ-DONE-001: エージェントがユーザー要求を満たしたと判断した**場合**、自動的に最終レポートを確定して提示**しなければならない**。
- REQ-DONE-002: エージェントが最終レポートを確定して提示する**とき**、追加の深掘り分析案がある場合は「任意の提案」として添えて提示してもよい。

## 非機能要件（NFR）

### ネットワーク

- NFR-NET-001: ネットワーク通信は **OpenAI（LLM API）への通信のみ許可**し、それ以外の外部通信を行ってはならない。

### ファイルシステム

- NFR-FS-001: CSVデータおよび生成したグラフは **指定されたワークディレクトリ（例: `./workspace/`）** に保存**してもよい**。ワークディレクトリ外へのファイルアクセスは行ってはならない。

### リソース制限

- NFR-RES-001: 1回の分析アクションは **3分以内 / 1GB以内**に制限されなければならない。
- NFR-LOOP-001: 1つの分析要求に対するReActループは **最大5回** を上限とし、超過した場合は中間結果を提示して終了**しなければならない**。

### 許可ライブラリ

- NFR-LIB-001: 実行で利用可能なライブラリは **pandas/numpy/sklearn/matplotlib/seaborn** に制限されなければならない。

### 国際化

- NFR-I18N-001: グラフ・レポート出力は **日本語** を正しく表示**しなければならない**。
